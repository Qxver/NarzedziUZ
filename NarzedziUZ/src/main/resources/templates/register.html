<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/theme.css}">
    <link rel="stylesheet" th:href="@{/css/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/register.css}">
    <script th:src="@{/js/theme.js}"></script>
    <title th:text="#{register.title}">Register</title>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>

<body>

<div th:insert="~{fragments/navbar :: navbar}"></div>

<div class="content">
    <div class="register">
        <h1 th:text="#{register.header}">Create new account</h1>

        <div th:if="${error}" style="color: red; margin-bottom: 15px;">
            <p th:text="${error}"></p>
        </div>

        <form method="post" action="/register" id="registerForm" onsubmit="return validateForm()">
            <input type="text" id="firstName" name="firstName" th:placeholder="#{register.first_name}" required>
            <span class="error-message" id="firstNameError" th:text="#{register.error.first_name}">First name is required</span>

            <input type="text" id="lastName" name="lastName" th:placeholder="#{register.last_name}" required>
            <span class="error-message" id="lastNameError" th:text="#{register.error.last_name}">Last name is required</span>

            <input type="email" id="email" name="email" th:placeholder="#{register.email}" required>
            <span class="error-message" id="emailError" th:text="#{register.error.email}">Please enter a valid email address</span>

            <input type="password" id="password" name="password" th:placeholder="#{register.password}" required>
            <div class="password-requirements">
                <div class="requirement" id="lengthReq">✗ [[#{register.req.length}]]</div>
                <div class="requirement" id="uppercaseReq">✗ [[#{register.req.uppercase}]]</div>
                <div class="requirement" id="numberReq">✗ [[#{register.req.number}]]</div>
                <div class="requirement" id="specialReq">✗ [[#{register.req.special}]]</div>
            </div>
            <span class="error-message" id="passwordError" th:text="#{register.error.password_req}">Password does not meet requirements</span>

            <input type="password" id="confirmPassword" name="confirmPassword" th:placeholder="#{register.confirm_password}" required>
            <span class="error-message" id="confirmPasswordError" th:text="#{register.error.password_match}">Passwords do not match</span>

            <button type="submit" th:text="#{register.btn}">Register</button>
            <div class="g-recaptcha" th:data-sitekey="${recaptchaSiteKey}" style="margin: 15px 0;"></div>

        </form>

        <a href="/login" th:text="#{register.login_link}">Already have an account? Login</a>
    </div>
</div>

<script>
   //error messages translate
    const msgReq = {
        length: [[#{register.req.length}]],
    uppercase: [[#{register.req.uppercase}]],
    number: [[#{register.req.number}]],
    special: [[#{register.req.special}]]
    };
    const emailPattern = /^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;
    const passwordPattern = /^(?=.*[0-9])(?=.*[!@#$%^&*(),.?":{}|<>]).{8,}$/;

    document.getElementById('password').addEventListener('input', function() {
        const password = this.value;

        const lengthReq = document.getElementById('lengthReq');
        if (password.length >= 8) {
            lengthReq.classList.remove('invalid');
            lengthReq.classList.add('valid');
            lengthReq.textContent = '✓' + msgReq.length;
        } else {
            lengthReq.classList.remove('valid');
            lengthReq.classList.add('invalid');
            lengthReq.textContent = '✗' + msgReq.length;
        }

        const uppercaseReq = document.getElementById('uppercaseReq');
        if (/[A-Z]/.test(password)) {
            uppercaseReq.classList.remove('invalid');
            uppercaseReq.classList.add('valid');
            uppercaseReq.textContent = '✓' + msgReq.uppercase;
        } else {
            uppercaseReq.classList.remove('valid');
            uppercaseReq.classList.add('invalid');
            uppercaseReq.textContent = '✗' + msgReq.uppercase;
        }

        const numberReq = document.getElementById('numberReq');
        if (/[0-9]/.test(password)) {
            numberReq.classList.remove('invalid');
            numberReq.classList.add('valid');
            numberReq.textContent = '✓' + msgReq.number;
        } else {
            numberReq.classList.remove('valid');
            numberReq.classList.add('invalid');
            numberReq.textContent = '✗' + msgReq.number;
        }

        const specialReq = document.getElementById('specialReq');
        if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) {
            specialReq.classList.remove('invalid');
            specialReq.classList.add('valid');
            specialReq.textContent = '✓' + msgReq.special;
        } else {
            specialReq.classList.remove('valid');
            specialReq.classList.add('invalid');
            specialReq.textContent = '✗' + msgReq.special;
        }
    });

    document.getElementById('confirmPassword').addEventListener('input', function() {
        const password = document.getElementById('password').value;
        const confirmPassword = this.value;
        const errorSpan = document.getElementById('confirmPasswordError');

        if (confirmPassword && password !== confirmPassword) {
            this.classList.add('invalid');
            errorSpan.classList.add('show');
        } else {
            this.classList.remove('invalid');
            errorSpan.classList.remove('show');
        }
    });

    function validateForm() {
        let isValid = true;

        const firstName = document.getElementById('firstName');
        const firstNameError = document.getElementById('firstNameError');
        if (firstName.value.trim() === '') {
            firstName.classList.add('invalid');
            firstNameError.classList.add('show');
            isValid = false;
        } else {
            firstName.classList.remove('invalid');
            firstNameError.classList.remove('show');
        }

        const lastName = document.getElementById('lastName');
        const lastNameError = document.getElementById('lastNameError');
        if (lastName.value.trim() === '') {
            lastName.classList.add('invalid');
            lastNameError.classList.add('show');
            isValid = false;
        } else {
            lastName.classList.remove('invalid');
            lastNameError.classList.remove('show');
        }

        const email = document.getElementById('email');
        const emailError = document.getElementById('emailError');
        if (!emailPattern.test(email.value)) {
            email.classList.add('invalid');
            emailError.classList.add('show');
            isValid = false;
        } else {
            email.classList.remove('invalid');
            emailError.classList.remove('show');
        }

        const password = document.getElementById('password');
        const passwordError = document.getElementById('passwordError');
        if (!passwordPattern.test(password.value)) {
            password.classList.add('invalid');
            passwordError.classList.add('show');
            isValid = false;
        } else {
            password.classList.remove('invalid');
            passwordError.classList.remove('show');
        }

        const confirmPassword = document.getElementById('confirmPassword');
        const confirmPasswordError = document.getElementById('confirmPasswordError');
        if (password.value !== confirmPassword.value) {
            confirmPassword.classList.add('invalid');
            confirmPasswordError.classList.add('show');
            isValid = false;
        } else {
            confirmPassword.classList.remove('invalid');
            confirmPasswordError.classList.remove('show');
        }

        return isValid;
    }
</script>

</body>
</html>