<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:th="http://www.thymeleaf.org" lang="pl">
<head>
    <meta charset="UTF-8"/>
    <title th:text="${pageTitle}">Faktura</title>
    <style type="text/css">
        /*<![CDATA[*/

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', Arial, sans-serif;
            background-color: #fff;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .invoice-container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            padding: 40px;
            border: 1px solid #e0e0e0;
        }

        /* Naglowek */
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #007bff;
        }

        .company-info h1 {
            font-size: 28px;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 10px;
        }

        .company-info p {
            font-size: 12px;
            color: #666;
            margin: 2px 0;
        }

        .invoice-meta {
            text-align: right;
        }

        .invoice-meta h2 {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .meta-row {
            font-size: 12px;
            margin: 4px 0;
            color: #666;
        }

        .meta-row strong {
            color: #333;
            display: inline-block;
            width: 80px;
        }

        /* Dane adresowe */
        .addresses-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            gap: 40px;
        }

        .address-block {
            flex: 1;
        }

        .address-block h3 {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: #007bff;
            margin-bottom: 8px;
        }

        .address-block p {
            font-size: 12px;
            color: #333;
            margin: 3px 0;
        }

        /* Tabela pozycji */
        .items-table {
            width: 100%;
            margin-bottom: 30px;
            border-collapse: collapse;
        }

        .items-table thead th {
            background-color: #007bff;
            color: white;
            padding: 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .items-table tbody td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 12px;
        }

        .items-table tbody tr:last-child td {
            border-bottom: 2px solid #333;
        }

        .items-table .text-right {
            text-align: right;
        }

        .items-table .text-center {
            text-align: center;
        }

        /* Podsumowanie */
        .summary-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 40px;
            margin-top: 20px;
        }

        .summary-box {
            width: 300px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            font-size: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-row.total {
            background-color: #f5f5f5;
            font-weight: 700;
            font-size: 14px;
        }

        .summary-label {
            color: #666;
        }

        .summary-value {
            color: #333;
            font-weight: 600;
        }

        .summary-row.total .summary-value {
            color: #007bff;
            font-size: 16px;
        }

        /* Uwagi */
        .notes-section {
            margin-bottom: 30px;
        }

        .notes-section h3 {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: #333;
            margin-bottom: 8px;
        }

        .notes-section p {
            font-size: 11px;
            color: #666;
            line-height: 1.5;
        }

        /* Stopka */
        .invoice-footer {
            border-top: 1px solid #e0e0e0;
            padding-top: 20px;
            margin-top: 30px;
            text-align: center;
            font-size: 10px;
            color: #999;
        }

        .page-break {
            page-break-after: always;
        }

        /*]]>*/
    </style>
</head>
<body>

<div class="invoice-container">

    <!-- Nagłówek z logo i numerem faktury -->
    <div class="invoice-header">
        <div class="company-info">
            <h1>NARZĘDZIUZ</h1>
            <p>Sklep z Narzędziami</p>
            <p>ul. Warsztatowa 15, 65-001 Zielona Góra</p>
            <p>NIP: 12-345-67-890</p>
            <p>Email: narzedziuz@gmail.com</p>
            <p>Tel: +48 68 000 0000</p>
        </div>
        <div class="invoice-meta">
            <h2>FAKTURA</h2>
            <div class="meta-row">
                <strong>Nr faktury:</strong>
                <span th:text="${order.orderId}">FV/2026/001</span>
            </div>
            <div class="meta-row">
                <strong>Data wystawienia:</strong>
                <span th:text="${#temporals.format(order.orderDate, 'dd.MM.yyyy')}">18.01.2026</span>
            </div>
            <div class="meta-row">
                <strong>Termin płatności:</strong>
                <span th:text="${#temporals.format(paymentDueDate, 'dd.MM.yyyy')}">18.02.2026</span>
            </div>
            <div class="meta-row">
                <strong>Status:</strong>
                <span th:text="${order.orderStatus}">NOWE</span>
            </div>
        </div>
    </div>

    <!-- Dane sprzedawcy i kupującego -->
    <div class="addresses-section">
        <div class="address-block">
            <h3>Sprzedawca</h3>
            <p><strong>NARZĘDZIUZ Sp. z o.o.</strong></p>
            <p>ul. Warsztatowa 15</p>
            <p>65-001 Zielona Góra</p>
            <p>NIP: 12-345-67-890</p>
            <p>Regon: 98-765-43-210</p>
        </div>
        <div class="address-block">
            <h3>Nabywca</h3>
            <p><strong th:text="${order.user.firstName} + ' ' + ${order.user.lastName}">Jan Kowalski</strong></p>
            <p th:text="${order.deliverAddress}">ul. Przykładowa 123, 65-002 Zielona Góra</p>
            <p th:text="${order.user.email}">jan.kowalski@email.com</p>
        </div>
    </div>

    <!-- Tabela z pozycjami zamówienia -->
    <table class="items-table">
        <thead>
        <tr>
            <th>Lp.</th>
            <th>Nazwa produktu</th>
            <th class="text-center">Ilość</th>
            <th class="text-right">Cena jednostkowa</th>
            <th class="text-right">Rabat</th>
            <th class="text-right">VAT (23%)</th>
            <th class="text-right">Razem</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item,iterStat : ${order.orderItems}">
            <td class="text-center" th:text="${iterStat.count}">1</td>
            <td th:text="${item.product.name}">Wiertarka elektryczna</td>
            <td class="text-center" th:text="${item.quantity}">2</td>
            <td class="text-right" th:text="${item.price} + ' zł'">899,00 zł</td>
            <td class="text-right" th:text="${item.price - order.priceSum + ' zł'}">0,00 zł</td>
            <td class="text-right" th:with="vat=${item.price * 0.23}">
                <span th:text="${#numbers.formatDecimal(vat, 2, 2)} + ' zł'">206,77 zł</span>
            </td>
            <td class="text-right" th:text="${order.priceSum} + ' zł'">1798,00 zł</td>
        </tr>
        </tbody>
    </table>

    <!-- Podsumowanie finansowe -->
    <div class="summary-section">
        <div class="summary-box">
            <div class="summary-row">
                <span class="summary-label">Netto:</span>
                <span class="summary-value" th:text="${#numbers.formatDecimal(order.priceSum / 1.23, 2, 2)} + ' zł'">1462,60 zł</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">VAT (23%):</span>
                <span class="summary-value" th:text="${#numbers.formatDecimal(order.priceSum - (order.priceSum / 1.23), 2, 2)} + ' zł'">335,40 zł</span>
            </div>
            <div class="summary-row total">
                <span class="summary-label">Razem do zapłaty:</span>
                <span class="summary-value" th:text="${order.priceSum} + ' zł'">1798,00 zł</span>
            </div>
        </div>
    </div>

    <!-- Informacje o dostawie -->
    <div class="notes-section">
        <h3>Informacje o dostawie</h3>
        <p>
            <strong>Metoda dostawy:</strong> Przesyłka kurierska DPD<br/>
            <strong>Spodziewana data dostawy:</strong> 20-22.01.2026<br/>
            <strong>Koszt dostawy:</strong> 0,00 zł (bezpłatnie)
        </p>
    </div>

    <!-- Warunki płatności -->
    <!-- Warunki platnosci -->
    <div class="notes-section">
        <h3>Metoda platnosci</h3>

        <!-- Wyświetla to, co zbudowaliśmy w kontrolerze (np. "PayPal (Online)") -->
        <p>
            <strong>Wybrano:</strong> <span th:text="${order.paymentMethod}">Metoda</span>
        </p>

        <!-- Pokaż instrukcję przelewu TYLKO JEŚLI wybrano przelew tradycyjny -->
        <div th:if="${#strings.contains(order.paymentMethod, 'Przelew') or #strings.contains(order.paymentMethod, 'TRANSFER')}">
            <p style="margin-top: 5px;">
                Prosimy o wplate na konto:<br/>
                <strong>NARZEDZIUZ Sp. z o.o.</strong><br/>
                PL 12 3456 0000 0000 0000 0000 1234<br/>
                W tytule prosimy podac numer faktury: <span th:text="${order.orderId}"></span>
            </p>
        </div>

        <!-- Informacja dla opłaconych zamówień (BLIK, Karta, PayPal) -->
        <div th:unless="${#strings.contains(order.paymentMethod, 'Przelew') or #strings.contains(order.paymentMethod, 'TRANSFER')}">
            <p style="margin-top: 5px; color: green;">
                Status: OPLACONE (Dziekujemy!)
            </p>
        </div>
    </div>


    <!-- Stopka -->
    <div class="invoice-footer">
        <p>Dziękujemy za zakupy! | Faktura wygenerowana automatycznie | narzędziuz.pl</p>
    </div>

</div>

</body>
</html>
