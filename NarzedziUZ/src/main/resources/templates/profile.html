<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{profile.title} + ' - NarzedziUZ'">Profil Klienta</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link th:href="@{/css/theme.css}" rel="stylesheet">
    <link th:href="@{/css/profile.css}" rel="stylesheet">
    <link th:href="@{/css/navbar.css}" rel="stylesheet">
    <script th:src="@{/js/theme.js}"></script>
</head>
<body>

<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="profile-wrapper">
    <div class="profile-container">
        <div class="profile-buttons">
            <div>
                <a th:if="${session.user != null and session.user.role == 'ADMIN'}"
                   th:href="@{/admin/dashboard}" class="profile-button"
                   th:text="#{profile.btn.admin}">Admin Panel</a>
            </div>
            <div>
                <a th:if="${session.user != null}" th:href="@{/user/wish-list}"
                   class="profile-button" th:text="#{profile.btn.wishlist}">wish list</a>
            </div>
            <div>
                <a th:if="${session.user != null}" th:href="@{/logout}"
                   class="profile-button" th:text="#{profile.btn.logout}">Log Out</a>
            </div>
        </div>
        <div class="profile-header">
            <h1 class="profile-title" th:text="#{profile.title}">My Profile</h1>
            <p class="welcome-text" th:text="#{profile.welcome(${user.firstName})}">Welcome Back</p>

            <div class="profile-avatar" th:text="${initials}">JK</div>

            <div class="profile-info">
                <div class="info-item">
                    <div class="info-label" th:text="#{profile.stats.purchases}">Purchases</div>
                    <div class="info-value" th:text="${totalPurchases}">12</div>
                </div>
                <div class="info-item">
                    <div class="info-label" th:text="#{profile.stats.spent}">Spent</div>
                    <div class="info-value">
                        <span th:text="${#numbers.formatDecimal(totalSpent, 1, 'DEFAULT', 2, 'DEFAULT')}"></span>
                        <span th:text="#{currency}">zł</span>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label" th:text="#{profile.stats.ratings}">Ratings</div>
                    <div class="info-value" th:text="${totalRatings}">8</div>
                </div>
            </div>
        </div>

        <div class="profile-content">
            <div class="section">
                <h2 class="section-title" th:text="#{profile.history.title}">Purchase History</h2>
                <div id="purchasesList">
                    <div th:each="purchase : ${purchases}" class="purchase-card">
                        <div class="purchase-header">
                            <div class="purchase-date" th:text="${purchase.formattedDate}">15 grudnia 2024</div>
                            <div class="purchase-status" th:text="${purchase.status}">Dostarczone</div>
                        </div>
                        <div class="purchase-items">
                            <div th:each="item : ${purchase.items}" class="purchase-item">
                                <span class="item-name" th:text="${item.productName}">Wiertarka</span>
                                <span class="item-price">
                   <span th:text="${#numbers.formatDecimal(item.price, 1, 'DEFAULT', 2, 'DEFAULT')}"></span>
                   <span th:text="#{currency}"></span>
                </span>
                            </div>
                        </div>
                        <div class="purchase-total">
                            <span class="total-label" th:text="#{profile.total}">Suma:</span>
                            <span class="total-amount">
                 <span th:text="${#numbers.formatDecimal(purchase.total, 1, 'DEFAULT', 2, 'DEFAULT')}"></span>
                 <span th:text="#{currency.symbol}"></span>
              </span>
                        </div>
                    </div>
                    <div th:if="${purchases.isEmpty()}" class="no-data" th:text="#{profile.history.empty}">Brak zakupów</div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title" th:text="#{profile.ratings.title}">Your Ratings</h2>

                <div th:each="rating : ${ratings}" class="rating-card">
                    <div class="rating-header">
                        <a th:href="@{/product/{id}(id=${rating.product.productId})}"
                           class="product-name-link"
                           th:text="${rating.product.name}">
                            Product name
                        </a>

                        <div class="stars" th:data-rating="${rating.rating}">
                <span th:each="i : ${#numbers.sequence(1,5)}"
                      th:class="${i <= rating.rating} ? 'star filled' : 'star'"
                      th:text="${i <= rating.rating} ? '⭐' : '☆'">⭐</span>
                        </div>
                    </div>

                    <div class="rating-comment" th:text="${rating.comment}">Comment</div>
                    <div class="rating-date" th:text="${#temporals.format(rating.createdAt, 'dd.MM.yyyy')}"></div>
                </div>

                <div th:if="${ratings.isEmpty()}" class="no-data" th:text="#{profile.ratings.empty}">No ratings</div>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/js/profil.js}"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    window.userConfig = /*[[${userConfig}]]*/ {};
    /*]]>*/
</script>
</body>
</html>